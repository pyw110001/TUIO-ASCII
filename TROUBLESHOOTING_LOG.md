# 故障排除与维护指南 (Troubleshooting & Maintenance Guide)

本文档总结了项目开发过程中遇到的核心问题及解决方案，旨在避免未来出现类似问题。

## 1. 自定义区域管理与保存问题

### 问题现象
- 手动拖拽绘图容易误操作。
- 区域 ID 无法直接修改。
- 切换页面后设置有时会消失（保存失效）。

### 解决方案
- **预设化布局**：优先使用“分割左右”或“分割上下”预设功能，确保区域划分精准。
- **ID 显式编辑**：在列表中直接提供 Input 输入框修改 ID，并配合“确认并保存”按钮进行显式持久化。
- **绘制锁定**：默认关闭“自由绘制模式”，仅在需要特殊形状时开启。
- **状态同步机制**：前端在页面加载时（`useEffect`）主动通过 API 获取 `zones.json` 中的最新存储值，而不完全依赖 WebSocket 的初始推送。

---

## 2. 服务器稳定性与 "Failed to Fetch" 错误

### 问题现象
- 前端操作（如切换模式）时弹出 "Failed to fetch" 弹窗。
- 后端 Node.js 进程在无报错信息的情况下意外退出。

### 解决方案
- **全局异常捕获**：在 `server/index.js` 中添加了 `process.on('uncaughtException')` 和 `rejection` 监听，确保即使出现网络波动或编码异常，进程也不会直接崩溃。
- **广播限流 (Throttling)**：将高频的 TUIO Cursor 广播频率降低（例如每 100ms 广播一次），减轻了 WebSocket 服务端和前端 Canvas 渲染的压力，有效降低了 CPU 占用和内存溢出风险。
- **状态轮询与补偿**：如果 API 请求失败，前端会尝试通过 WebSocket 或下一次手动操作进行补偿加载。

---

## 3. TCP 连接稳定性

### 问题现象
- `ECONNRESET` 或频繁断开连接。

### 解决方案
- **指数退避重连**：实现了 `TCPSender` 的自动重连机制，在连接失败后按 1s, 2s, 4s... 的间隔尝试重新建立连接。
- **静默重连**：减少了重连时的日志输出量，仅记录关键的首次连接失败和最终重连成功。

## 开发建议 (Best Practices)
1. **修改 API 时**：确保后端 `res.json` 返回的数据结构与前端 `api.js` 中期待的一致。
2. **布局调整时**：优先考虑 CSS Grid，以便在侧边栏集成实时监控（如“发送历史”），提高调试效率。
3. **性能监控**：如发现 UI 卡顿，首先检查 `server/index.js` 中的 `setInterval` 广播频率。
