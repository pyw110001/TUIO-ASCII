# 问题修复说明

## 修复的问题

### 1. 前端依赖未安装 ✅

**问题**：
- 运行 `npm run dev` 时前端报错：`'vite' 不是内部或外部命令`
- 前端 `node_modules` 未安装

**修复**：
- 已执行 `cd client && npm install` 安装前端依赖
- 现在前端可以正常启动

**验证**：
```bash
cd client
npm run dev
# 应该能正常启动 Vite 开发服务器
```

### 2. TCP 客户端频繁重连 ✅

**问题**：
- TCP 客户端连接失败时，错误日志刷屏
- 重连逻辑可能被重复触发
- 没有防止重复调度的机制

**修复**：
1. **添加重连状态标志**：
   - `isReconnecting`: 防止重复调度重连
   - `reconnectTimer`: 跟踪当前重连定时器

2. **优化错误处理**：
   - 只在首次错误时发送错误通知，避免日志刷屏
   - 检查连接状态，避免在已连接时重复处理错误
   - 只在连接真正关闭时调度重连

3. **改进重连逻辑**：
   - 防止重复调度（检查 `isReconnecting` 和 `reconnectTimer`）
   - 只在首次重连时显示日志信息
   - 达到最大重连次数后停止重连并通知用户

4. **连接状态检查**：
   - 在重连前检查连接状态，避免重复连接
   - 连接成功时重置所有重连相关状态

**改进效果**：
- ✅ 减少错误日志输出（只在首次错误时通知）
- ✅ 避免重复重连调度
- ✅ 更清晰的重连状态管理
- ✅ 达到最大重连次数后停止尝试

## 使用建议

### TCP 连接失败时的行为

1. **首次连接失败**：
   - 显示错误信息
   - 开始重连（指数退避：1s, 2s, 4s, ... 最大 30s）
   - 最多尝试 10 次

2. **达到最大重连次数**：
   - 停止重连尝试
   - 显示最终错误信息
   - 用户可以在配置页面修改 TCP 设置后重新连接

3. **正常情况**：
   - 如果目标设备未运行，这是正常行为
   - 可以在配置页面切换到"服务端模式"等待设备连接
   - 或者先启动目标设备，然后系统会自动连接

### 测试建议

1. **测试 TCP 客户端模式**：
   ```bash
   # 启动一个简单的 TCP 服务器来测试
   # 使用 netcat (Linux/Mac)
   nc -l 8080
   
   # 或使用 PowerShell (Windows)
   # 需要先安装 netcat 或使用其他工具
   ```

2. **测试 TCP 服务端模式**：
   - 在配置页面切换到"服务端模式"
   - 设置监听端口（如 8080）
   - 使用 TCP 客户端工具连接测试

3. **验证重连逻辑**：
   - 启动系统（客户端模式，目标设备未运行）
   - 观察日志：应该只看到一次错误通知和重连信息
   - 启动目标设备后，应该自动连接成功

## 后续优化建议

1. **配置选项**：
   - 允许用户配置最大重连次数
   - 允许用户配置重连延迟

2. **UI 改进**：
   - 在监控页面显示重连状态和剩余重连次数
   - 提供"手动重连"按钮

3. **日志改进**：
   - 添加日志级别控制
   - 提供日志过滤选项

